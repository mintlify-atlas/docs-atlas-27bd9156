---
title: Webhook Endpoints
description: Third-party webhook handlers for Stripe and WorkOS
---

Executor receives webhooks from external services for payment processing and authentication events.

## Stripe Webhook

Receives Stripe payment and subscription events.

```http
POST /stripe/webhook
```

### Authentication

Requires valid Stripe webhook signature in the `Stripe-Signature` header. Signature is verified using the webhook secret configured in `STRIPE_WEBHOOK_SECRET`.

### Headers

<ParamField header="Stripe-Signature" type="string" required>
  Stripe webhook signature. Generated by Stripe for each webhook delivery. Format: `t=<timestamp>,v1=<signature>`
</ParamField>

<ParamField header="Content-Type" type="string" required>
  Must be `application/json`
</ParamField>

### Request Body

Stripe event object:

```json
{
  "id": "evt_1234567890",
  "object": "event",
  "type": "customer.subscription.created",
  "data": {
    "object": {
      // Event-specific payload
    }
  },
  "created": 1234567890
}
```

### Supported Events

Executor handles these Stripe event types:

<ResponseField name="customer.subscription.created">
  New subscription created
</ResponseField>

<ResponseField name="customer.subscription.updated">
  Subscription modified (plan change, status change, etc.)
</ResponseField>

<ResponseField name="customer.subscription.deleted">
  Subscription canceled or expired
</ResponseField>

<ResponseField name="invoice.payment_succeeded">
  Successful payment for an invoice
</ResponseField>

<ResponseField name="invoice.payment_failed">
  Failed payment attempt
</ResponseField>

<ResponseField name="checkout.session.completed">
  Checkout session completed successfully
</ResponseField>

### Response

```json
{
  "received": true
}
```

HTTP 200 indicates successful receipt and processing.

### Example Request

```bash
curl -X POST https://executor.example.com/stripe/webhook \
  -H "Stripe-Signature: t=1234567890,v1=abc123..." \
  -H "Content-Type: application/json" \
  -d '{
    "id": "evt_1234567890",
    "type": "customer.subscription.created",
    "data": {
      "object": {
        "id": "sub_1234567890",
        "customer": "cus_1234567890",
        "status": "active"
      }
    }
  }'
```

### Error Responses

<ResponseField name="400 Bad Request">
  Invalid webhook signature or malformed payload
</ResponseField>

<ResponseField name="401 Unauthorized">
  Missing or invalid `Stripe-Signature` header
</ResponseField>

### Configuration

Stripe webhook handling requires:

<ParamField path="STRIPE_WEBHOOK_SECRET" type="string" required>
  Webhook signing secret from Stripe dashboard. Used to verify webhook authenticity.
</ParamField>

<ParamField path="STRIPE_API_KEY" type="string" required>
  Stripe secret API key for making API calls
</ParamField>

### Testing

Use Stripe CLI to test webhooks locally:

```bash
stripe listen --forward-to localhost:3000/stripe/webhook
stripe trigger customer.subscription.created
```

## WorkOS Webhooks

WorkOS AuthKit automatically registers webhook endpoints for authentication events.

### Registration

Webhook routes are registered via `@convex-dev/workos-authkit`:

```typescript
authKit.registerRoutes(http);
```

The AuthKit package handles:
- Webhook URL registration
- Signature verification
- Event parsing and routing

### Supported Events

<ResponseField name="organization.created">
  New organization created in WorkOS
</ResponseField>

<ResponseField name="organization.updated">
  Organization details modified
</ResponseField>

<ResponseField name="organization.deleted">
  Organization removed from WorkOS
</ResponseField>

<ResponseField name="organization_membership.created">
  User added to organization
</ResponseField>

<ResponseField name="organization_membership.updated">
  Organization membership modified (role change, etc.)
</ResponseField>

<ResponseField name="organization_membership.deleted">
  User removed from organization
</ResponseField>

<ResponseField name="user.created">
  New user account created
</ResponseField>

<ResponseField name="user.updated">
  User profile updated
</ResponseField>

<ResponseField name="user.deleted">
  User account deleted
</ResponseField>

<ResponseField name="session.created">
  New user session started
</ResponseField>

### Event Processing

WorkOS events are processed by handlers in `executor/packages/database/src/auth/event_handlers.ts`. Event processing:

1. **Signature Verification** - AuthKit verifies the webhook signature using `WORKOS_WEBHOOK_SECRET`
2. **Event Routing** - Events are routed to type-specific handlers
3. **Database Updates** - Handlers update Convex database tables:
   - Organizations → `organizations` table
   - Memberships → `organizationMembers` table
   - Users → `accounts` table
4. **Workspace Sync** - Organization changes trigger workspace provisioning/updates

### Configuration

WorkOS webhook handling requires:

<ParamField path="WORKOS_CLIENT_ID" type="string" required>
  WorkOS application client ID
</ParamField>

<ParamField path="WORKOS_API_KEY" type="string" required>
  WorkOS API key for making API calls
</ParamField>

<ParamField path="WORKOS_WEBHOOK_SECRET" type="string" required>
  Webhook signing secret from WorkOS dashboard
</ParamField>

### Webhook URLs

AuthKit registers webhook endpoints dynamically. Typical URL pattern:

```
https://executor.example.com/auth/workos/webhook
```

Exact path is managed by the `@convex-dev/workos-authkit` package.

### Testing

Test WorkOS webhooks using the WorkOS dashboard:

1. Navigate to **Webhooks** in WorkOS dashboard
2. Add endpoint URL: `https://your-deployment.convex.site/auth/workos/webhook`
3. Select event types to subscribe to
4. Use **Send test webhook** to trigger events

### Event Handler Implementation

Event handlers are configured in `executor/packages/database/convex/auth.ts:7-41`:

```typescript
const authKitInstance = new AuthKit<DataModel>(workosComponent, {
  authFunctions,
  additionalEventTypes: [
    "organization.created",
    "organization.updated",
    "organization.deleted",
    "organization_membership.created",
    "organization_membership.updated",
    "organization_membership.deleted",
  ],
});

const authKitEvents = authKitInstance.events(workosEventHandlers);
```

Handlers are implemented in `executor/packages/database/src/auth/event_handlers.ts`.

## Webhook Security

### Signature Verification

All webhooks verify signatures before processing:

<Steps>
  <Step title="Extract Signature">
    Parse signature from request headers:
    - Stripe: `Stripe-Signature` header
    - WorkOS: Verified by AuthKit middleware
  </Step>
  
  <Step title="Compute Expected Signature">
    Calculate HMAC using webhook secret and request body
  </Step>
  
  <Step title="Compare Signatures">
    Use timing-safe comparison to prevent timing attacks
  </Step>
  
  <Step title="Reject Invalid Signatures">
    Return 401 Unauthorized if signatures don't match
  </Step>
</Steps>

### Replay Protection

Webhooks include timestamp verification:

- **Stripe**: Timestamp in signature (`t=` component) must be within tolerance window
- **WorkOS**: AuthKit handles replay protection automatically

### IP Allowlisting

Consider restricting webhook endpoints to known service IPs:

- **Stripe IPs**: https://stripe.com/docs/ips
- **WorkOS IPs**: Contact WorkOS support

## Monitoring

### Webhook Logs

Webhook processing logs are available in Convex dashboard under **Logs** → **Functions**. Filter by:

- Stripe: Search for `stripe/webhook`
- WorkOS: Search for `authKit` or `workos`

### Failed Deliveries

Check service dashboards for delivery failures:

- **Stripe**: Dashboard → Developers → Webhooks → View logs
- **WorkOS**: Dashboard → Webhooks → Event log

### Retry Behavior

- **Stripe**: Automatic retries with exponential backoff (up to 3 days)
- **WorkOS**: Automatic retries with exponential backoff

Both services mark endpoints as unhealthy after repeated failures.

## Source Files

- Route registration: `executor/packages/database/convex/http.ts:14-17`
- Stripe integration: Via `@convex-dev/stripe` package
- WorkOS integration: `executor/packages/database/convex/auth.ts:1-54`
- WorkOS event handlers: `executor/packages/database/src/auth/event_handlers.ts`
